letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T']
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19].reverse()
line = 19
size = 30
step = 0

Piece = (x, y, size, type) ->
  this.x = x || 0
  this.y = y || 0
  this.size = size || 1
  this.type = type || 'B'

Piece.prototype.draw = (ctx) ->
  ctx.beginPath()
  ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI, true)
  ctx.lineWidth = 1
  if this.type == 'B'
    ctx.fillStyle = '#000000'
  else
    ctx.fillStyle = '#ffffff'
  ctx.fill()
  ctx.stroke()
  return

Board = (grid, size) ->
  this.grid = grid || 19
  this.size = size || 25

Board.prototype.draw = (ctx) ->
  ctx.beginPath()
  for i in [1..this.grid]
    ctx.moveTo(i * this.size, this.size)
    ctx.lineTo(i * this.size, this.grid * this.size)
    ctx.moveTo(this.size, i * this.size)
    ctx.lineTo(this.grid * this.size, i * this.size)
  ctx.stroke()

Cross = (size) ->
  this.size = size || 5

Cross.prototype.draw = (ctx, coord) ->
  ctx.beginPath()
  ctx.stroke()

convert_pos_to_coord = (x, y, size) ->
  letter = letters[Math.round((x - size) / size)]
  number = numbers[Math.round((y - size) / size)]
  return "#{letter}#{number}"

move = (ctx, pos, type) ->
  letter = pos.charAt(0)
  number = pos.slice(1)
  i = letters.indexOf(letter) + 1
  j = numbers.indexOf(parseInt(number)) + 1
  Piece piece = new Piece()
  piece.x = i * size
  piece.y = j * size
  piece.size = size / 2 - 3
  piece.type = type
  piece.draw(ctx)

drawStarPoint = (x, y, ctx, size) ->
  ctx.beginPath()
  ctx.arc(x, y, size, 0, 2 * Math.PI, true)
  ctx.fill()
  return

drawBoard = (ctx, grid, size, dot_size) ->
  Board board = new Board()
  board.size = size
  board.draw(ctx)
  drawStarPoint(size * 4, size * 4, ctx, dot_size)
  drawStarPoint(size * 10, size * 4, ctx, dot_size)
  drawStarPoint(size * 16, size * 4, ctx, dot_size)
  drawStarPoint(size * 16, size * 16, ctx, dot_size)
  if grid == 19
    drawStarPoint(size * 10, size * 16, ctx, dot_size)
    drawStarPoint(size * 10, size * 10, ctx, dot_size)
    drawStarPoint(size * 16, size * 10, ctx, dot_size)
    drawStarPoint(size * 4, size * 10, ctx, dot_size)
    drawStarPoint(size * 4, size * 16, ctx, dot_size)
  return

canvas = document.getElementById("board")
canvas.width = size * 19
canvas.height = size * 19
ctx = canvas.getContext('2d')

$('#board').click (e) ->
  coord = convert_pos_to_coord(e.offsetX, e.offsetY, size)
  step++
  if step % 2 == 0
    move(ctx, coord, 'W')
  else
    move(ctx, coord, 'B')

$('#board').mousemove (e) ->
  coord = convert_pos_to_coord(e.offsetX, e.offsetY, size)
  $('#coord').html(coord)

drawBoard(ctx, line, size, 3)
