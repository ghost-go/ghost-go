letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T']
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19].reverse()
line = 19
size = 50
step = 0

Piece = (x, y, size, type) ->
  this.x = x || 0
  this.y = y || 0
  this.size = size || 1
  this.type = type || 'B'

Piece.prototype.draw = (ctx) ->
  ctx.beginPath()
  ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI, true)
  ctx.lindWidth = 2
  if this.type == 'B'
    ctx.fillStyle = '#000000'
  else
    ctx.fillStyle = '#ffffff'
  ctx.fill()
  ctx.stroke()
  return

convert_coordinate = (x, y, size) ->
  letter = letters[Math.round((x - size) / size)]
  number = numbers[Math.round((y - size) / size)]
  return "#{letter}#{number}"

move = (ctx, pos, type) ->
  letter = pos.charAt(0)
  number = pos.slice(1)
  i = letters.indexOf(letter) + 1
  j = numbers.indexOf(parseInt(number)) + 1
  Piece piece = new Piece()
  piece.x = i * size
  piece.y = j * size
  piece.size = size / 2 - 3
  piece.type = type
  piece.draw(ctx)

drawStarPoint = (x, y, ctx, size) ->
  ctx.beginPath()
  ctx.arc(x, y, size, 0, 2 * Math.PI, true)
  ctx.fill()
  return

drawBoard = (ctx, grid, size, dot_size) ->
  ctx.beginPath
  for i in [1..grid]
    ctx.moveTo(i * size, size)
    ctx.lineTo(i * size, grid * size)
    ctx.moveTo(size, i * size)
    ctx.lineTo(grid * size, i * size)
  ctx.stroke()
  drawStarPoint(size * 4, size * 4, ctx, dot_size)
  drawStarPoint(size * 10, size * 4, ctx, dot_size)
  drawStarPoint(size * 16, size * 4, ctx, dot_size)
  drawStarPoint(size * 16, size * 16, ctx, dot_size)
  if grid == 19
    drawStarPoint(size * 10, size * 16, ctx, dot_size)
    drawStarPoint(size * 10, size * 10, ctx, dot_size)
    drawStarPoint(size * 16, size * 10, ctx, dot_size)
    drawStarPoint(size * 4, size * 10, ctx, dot_size)
    drawStarPoint(size * 4, size * 16, ctx, dot_size)
  return

canvas = document.getElementById("board")
ctx = canvas.getContext('2d')

$('#board').click (e) ->
  coordinate = convert_coordinate(e.offsetX, e.offsetY, size)
  step++
  if step % 2 == 0
    move(ctx, coordinate, 'W')
  else
    move(ctx, coordinate, 'B')

$('#board').mouseover (e) ->
  coordinate = convert_coordinate(e.offsetX, e.offsetY, size)
  alert(coordinate)

drawBoard(ctx, line, size, 3)
